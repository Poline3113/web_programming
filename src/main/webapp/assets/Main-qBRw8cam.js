import{_ as y,c,a as n,o as d,t as h,d as x,e as P,F as v,r as b,w as F,v as T,g as A,f as _,h as w,n as k}from"./index-DjAEp6Ea.js";import{g as E,d as S,a as X}from"./RestApi-CuVMHvV9.js";const M={name:"Graph",props:{r:{type:Array,required:!0},dots:{type:Array,default:()=>[]}},data(){return{canvas:null,ctx:null,currentR:1}},mounted(){this.canvas=this.$refs.graphCanvas,this.ctx=this.canvas.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",this.resizeCanvas)},beforeUnmount(){window.removeEventListener("resize",this.resizeCanvas)},watch:{r:{handler(t){if(t&&t.length>0){this.draw();for(let e of t)this.currentR=e,this.drawDots()}},immediate:!0,deep:!0},dots:{handler(){this.draw(),this.drawDots()},deep:!0,immediate:!0}},methods:{resizeCanvas(){const t=this.canvas.parentElement,e=Math.min(t.clientWidth,t.clientHeight,400);this.canvas.width=e,this.canvas.height=e,this.draw(),this.drawDots()},draw(){if(!this.ctx)return;this.currentR||(this.currentR=1);const t=this.ctx,e=this.canvas.width,a=this.canvas.height,s=e/2,r=a/2,i=Math.min(e,a)*.4;t.clearRect(0,0,e,a),t.fillStyle="rgba(59, 130, 246, 0.3)",t.fillRect(s-i,r,i,i/2),t.beginPath(),t.moveTo(s,r),t.lineTo(s+i/2,r),t.lineTo(s,r+i/2),t.closePath(),t.fill(),t.beginPath(),t.moveTo(s,r),t.arc(s,r,i/2,-Math.PI,-Math.PI/2,!1),t.closePath(),t.fill(),t.strokeStyle="black",t.lineWidth=2,t.beginPath(),t.moveTo(0,r),t.lineTo(e,r),t.stroke(),t.beginPath(),t.moveTo(s,0),t.lineTo(s,a),t.stroke(),t.fillStyle="black",t.font="12px Arial",t.textAlign="center",t.textBaseline="middle",t.fillText("R",s+i,r-10),t.fillText("-R",s-i,r-10),t.fillText("R/2",s+i/2,r-10),t.fillText("-R/2",s-i/2,r-10),t.fillText("R",s+15,r-i),t.fillText("-R",s+15,r+i),t.fillText("R/2",s+15,r-i/2),t.fillText("-R/2",s+15,r+i/2),t.fillText("x",e-15,r-15),t.fillText("y",s+15,15)},drawDots(){if(!this.ctx||!this.r.length||!this.dots.length)return;const t=this.canvas.width,e=this.canvas.height,a=t/2,s=e/2,r=Math.min(t,e)*.4,i=this.r.map(l=>parseFloat(this.r));this.dots.filter(l=>l&&l.r!==void 0&&i.includes(parseFloat(l.r))).forEach(l=>{const o=parseFloat(l.x),p=parseFloat(l.y),g=l.result||l.hit,m=a+o*r/parseFloat(l.r),f=s-p*r/parseFloat(l.r);this.drawPoint(m,f,g)})},drawPoint(t,e,a){const s=this.ctx;s.beginPath(),s.arc(t,e,5,0,2*Math.PI),s.fillStyle=a?"#4CAF50":"#f44336",s.shadowColor=a?"rgba(76, 175, 80, 0.5)":"rgba(244, 67, 54, 0.5)",s.shadowBlur=4,s.fill(),s.shadowBlur=0,s.strokeStyle="white",s.lineWidth=1.5,s.stroke(),s.closePath()},handleCanvasClick(t){if(!this.currentR){this.$emit("error","Сначала выберите R");return}const e=this.canvas.getBoundingClientRect(),a=this.canvas.width/e.width,s=this.canvas.height/e.height,r=(t.clientX-e.left)*a,i=(t.clientY-e.top)*s,u=this.canvas.width,l=this.canvas.height,o=u/2,p=l/2;for(let g of this.r){const m=Math.min(u,l)*.4,f=(r-o)/m,C=(p-i)/m,R=(f*g).toFixed(2),D=(C*g).toFixed(2);this.$emit("point-click",parseFloat(R),parseFloat(D),g)}}}},B={class:"graph"},Y={class:"svg-wrapper"};function V(t,e,a,s,r,i){return d(),c("div",B,[n("div",Y,[n("canvas",{ref:"graphCanvas",class:"graph-canvas",onClick:e[0]||(e[0]=(...u)=>i.handleCanvasClick&&i.handleCanvasClick(...u))},null,512)])])}const $=y(M,[["render",V]]),z={name:"Button",props:{label:String}};function H(t,e,a,s,r,i){return d(),c("button",null,h(a.label),1)}const I=y(z,[["render",H]]),G={name:"Main",components:{Graph:$,Button:I},data(){return{x:[1],y:"",r:[1],dots:[],xOptions:[-4,-3,-2,-1,0,1,2,3,4],rOptions:[-4,-3,-2,-1,0,1,2,3,4],errorMessage:""}},watch:{x:{handler(t){this.validateX()},deep:!0},y(t){this.validateY(t)},r:{handler(t){this.validateR()&&this.loadDots()},deep:!0}},methods:{async handleGraphClick(t,e,a){if(this.r.length===0){this.errorHandler("Сначала выберите R");return}await this.addDots(t,e,a)},validateX(){let t=document.getElementById("submit-button");const e=this.x.length>0;return e?t?.removeAttribute("disabled"):t?.setAttribute("disabled","true"),e},validateY(t){let e=document.getElementById("input-y"),a=document.getElementById("submit-button");const s=parseFloat(t),r=!isNaN(s)&&s>=-5&&s<=3&&t!=="";return r?(e?.classList.remove("red"),e?.removeAttribute("style"),a?.removeAttribute("disabled")):(e?.classList.add("red"),e?.setAttribute("style","color: red"),a?.setAttribute("disabled","true")),r},validateR(){let t=document.getElementById("submit-button");const e=this.r.length>0;return e?t?.removeAttribute("disabled"):t?.setAttribute("disabled","true"),e},toggleX(t){this.x=[t]},toggleR(t){this.r=[t]},isXSelected(t){return this.x.includes(t)},isRSelected(t){return this.r.includes(t)},async addDots(t,e,a){try{const s=await X({x:parseFloat(t),y:parseFloat(e.replace(",",".")),r:parseFloat(a)});this.loadDots(),this.$notify({group:"success",title:"Adding Point",text:`Точка (${t}, ${e}, ${a}) добавлена`,type:"success"})}catch(s){this.errorHandler(s.message||"Error adding point"),console.error(s)}},async deleteDots(){try{const t=await S();this.dots=[],this.loadDots(),this.$notify({group:"success",title:"Deleting Points",text:t.status||"Points deleted successfully",type:"success"})}catch(t){this.errorHandler(t.message||"Error deleting points"),console.error(t)}},logout(){_(),this.$router.push({name:"login-page"}),this.$notify({group:"success",title:"Logout",text:"Success",type:"success"})},async loadDots(){try{let e=(await E()).message||[];Array.isArray(e)||(e=[e]),this.dots=e,this.$forceUpdate()}catch(t){this.errorHandler(t.message||"Error loading points"),console.error(t),t.response&&t.response.status===401&&(_(),this.$router.push({name:"login-page"}))}},validateForm(){const t=this.x.length>0,e=this.validateY(this.y),a=this.r.length>0;if(t&&e&&a)for(const s of this.x)for(const r of this.r)this.addDots(s,this.y,r);else{let s="Проверьте введенные данные:";t||(s+=" X не выбран"),e||(s+=" Y вне диапазона [-5; 3]"),a||(s+=" R не выбран"),this.errorHandler(s)}},errorHandler(t){this.errorMessage=t,setTimeout(()=>{this.errorMessage=""},5e3),this.$notify({group:"error",title:"Error",text:t,type:"error"})}},async mounted(){if(!A()){this.$router.push({name:"login-page"});return}await this.loadDots(),this.$nextTick(()=>{window.dispatchEvent(new Event("resize"))}),setInterval(()=>{this.loadDots()},2e3)}},L={class:"main"},N={class:"container"},O={class:"text-center"},U={key:0,class:"error-message"},W={class:"inputs"},q={class:"button-group"},j=["onClick"],J={class:"row"},K={class:"text-label"},Q={class:"button-group"},Z=["onClick"],tt={class:"special-button"},et={class:"special-button"},st={class:"container-table"},rt={class:"text-center"},it={class:"table-check"};function nt(t,e,a,s,r,i){const u=w("Graph"),l=w("Button");return d(),c("section",L,[n("div",N,[n("div",O,[x(u,{r:r.r,dots:r.dots,onPointClick:i.handleGraphClick,onError:i.errorHandler},null,8,["r","dots","onPointClick","onError"]),r.errorMessage?(d(),c("div",U,h(r.errorMessage),1)):P("",!0),n("div",W,[e[3]||(e[3]=n("p",null,"Выберите Х:",-1)),n("div",q,[(d(!0),c(v,null,b(r.xOptions,o=>(d(),c("button",{key:"x-"+o,type:"button",class:k(["choice-btn",{active:i.isXSelected(o)}]),onClick:p=>i.toggleX(o)},h(o),11,j))),128))]),e[4]||(e[4]=n("p",null,"Выберите Y:",-1)),n("div",J,[n("label",K,[F(n("input",{id:"input-y",class:"text-input",type:"text",name:"y",placeholder:"[-5; 3]","onUpdate:modelValue":e[0]||(e[0]=o=>r.y=o)},null,512),[[T,r.y]])])]),e[5]||(e[5]=n("p",null,"Выберите R:",-1)),n("div",Q,[(d(!0),c(v,null,b(r.rOptions,o=>(d(),c("button",{key:"r-"+o,type:"button",class:k(["choice-btn",{active:i.isRSelected(o)}]),onClick:p=>i.toggleR(o)},h(o),11,Z))),128))])]),n("div",tt,[n("button",{id:"submit-button",onClick:e[1]||(e[1]=(...o)=>i.validateForm&&i.validateForm(...o)),type:"submit"},"Проверить"),n("button",{id:"remove-button",onClick:e[2]||(e[2]=(...o)=>i.deleteDots&&i.deleteDots(...o))},"Стереть точки")]),n("div",et,[x(l,{id:"logout",label:"Выйти из аккаунта",onClick:i.logout},null,8,["onClick"])])])]),n("div",st,[n("div",rt,[n("table",it,[e[6]||(e[6]=n("thead",{class:"thead"},[n("tr",{class:"table-header"},[n("th",{scope:"col"},"X"),n("th",{scope:"col"},"Y"),n("th",{scope:"col"},"R"),n("th",{scope:"col"},"Пользователь"),n("th",{scope:"col"},"Результат")])],-1)),n("tbody",null,[(d(!0),c(v,null,b(r.dots,o=>(d(),c("tr",{key:o,class:"table-row"},[n("td",null,h(o.x),1),n("td",null,h(o.y),1),n("td",null,h(o.r),1),n("td",null,h(o?.owner?.username||o?.creator?.name||"N/A"),1),n("td",null,h(o.hit?"hit":"miss"),1)]))),128))])])])])])}const lt=y(G,[["render",nt]]);export{lt as default};
